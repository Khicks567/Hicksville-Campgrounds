<% layout('layouts/boilerplate')%>

<div class="row">
    <div class="col-12 col-md-6 mb-3"> 
        <div class="card">
            
            <div id="Autoplaying" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <% if(camp.image.length === 0){ %>
                        <div class="carousel-item active">
                            <img src="/defaultImage.png" class="card-img-top default" alt="No Picture available for <%=camp.title %>">
                        </div>
                    <% } else { %>
                        <% camp.image.forEach((img, i) => { %>
                            <div class="carousel-item <%= i === 0 ? "active" : "" %> ">
                                <img crossorigin="anonymous" src="<%= img.url %>" class="d-block w-100 h-200" alt="Image of <%=camp.title %>">
                            </div>
                        <% }) %>
                    <% } %>
                </div>
                
                <% if(camp.image.length > 1) { %>
                <button class="carousel-control-prev" type="button" data-bs-target="#Autoplaying" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#Autoplaying" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
                <% } %>
            </div>

            <div class="card-body">
                <h5 class="card-title"><%=camp.title %></h5>
                <p class="card-text"><%=camp.description %></p>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    Submitted by: <%= camp.author.username %>
                </li>
                <li class="list-group-item">Price: $<%=camp.price %> per night</li>
                <li class="list-group-item">Location: <%=camp.location %></li>
            </ul>

            <% if(currentuser && camp.author.equals(currentuser)){ %>
            <div class="card-body d-flex flex-wrap"> 
                <a
                    href="/camp/<%=camp._id%>/editcampground"
                    class="card-link btn btn-success mb-2 me-2"
                    >Edit Campground</a
                >
                <a
                    href="/camp/<%=camp._id%>/editcampground/photos"
                    class="card-link btn btn-success mb-2 me-2"
                    >Edit Photos</a
                >

                <form
                    class="d-inline"
                    action="/camp/<%= camp._id %>?_method=DELETE"
                    method="POST"
                >
                    <button class="btn btn-danger mb-2">Delete Campground</button>
                </form>
            </div>
            <% } %>
        </div>
    </div>
    
    <div class="col-12 col-md-6 mb-3">
        <div id='map' class="showMap";></div>
    </div>
    
</div>

<div class="row mt-3">
    <div class="col-12 col-lg-6 offset-lg-3">

        <% if(currentuser ){ %>
        <div class="row mb-5">
            <div class="col-12">
                <h4 class="text-center mb-3">Please leave a Review</h4>
                <form
                    action="/camp/review/<%= camp._id %>"
                    novalidate
                    method="POST"
                    class="needs-validation"
                >
                    <div class="mb-3">
                        <label class="form-label" for="rating">Campground Rating: </label>
                        <div class="mt-3">
                            <fieldset class="starability-growRotate">
                                <input type="radio" id="no-rate" class="input-no-rate" name="rating" value="0" checked aria-label="No rating." />
                                <input type="radio" id="first-rate1" name="rating" value="1" />
                                <label for="first-rate1" title="Terrible">1 star</label>
                                <input type="radio" id="first-rate2" name="rating" value="2" />
                                <label for="first-rate2" title="Not good">2 stars</label>
                                <input type="radio" id="first-rate3" name="rating" value="3" />
                                <label for="first-rate3" title="Average">3 stars</label>
                                <input type="radio" id="first-rate4" name="rating" value="4" />
                                <label for="first-rate4" title="Very good">4 stars</label>
                                <input type="radio" id="first-rate5" name="rating" value="5" />
                                <label for="first-rate5" title="Amazing">5 stars</label>
                            </fieldset>
                            <div class="invalid-feedback">Please Enter a Rating.</div>
                        </div>
                    </div>

                    <label class="form-label" for="comment">Comment: </label>
                    <div class="form-floating mb-3">
                        <textarea
                            class="form-control"
                            id="comment"
                            name="comment"
                            placeholder="Enter Comment"
                            required
                        ></textarea>
                        <label for="comment">Enter Comment</label>
                        <div class="invalid-feedback">Please Enter a Comment.</div>
                    </div>

                    <button class="btn btn-primary my-3">Submit Review</button>
                </form>
            </div>
        </div>
        <% } %> 

        <h4 class="mb-3">Campground Reviews</h4>
        <% for(let review of camp.review ){ %>
        <div class="card mb-3">
            <div class="card-body">
                <section class="mb-3">
                    <h6 class="card-subtitle mb-2 text-muted">Reviewed by <%= review.user.username %></h6>

                    <p class="starability-result mb-2" data-rating="<%=review.rating%>">
                        Rated: <%= review.rating %> stars
                    </p>
                </section>
                <p class="card-text"><%= review.comment %></p>
            </div>
            <% if(currentuser && review.user.equals(currentuser.id)){ %>
            <div class="card-footer bg-white border-0">
                <form
                    class="d-inline"
                    action="/camp/<%=camp._id%>/review/<%= review._id %>?_method=DELETE"
                    method="POST"
                >
                    <button class="btn btn-sm btn-danger">Delete Review</button>
                </form>
            </div>
            <% } %>
        </div>
        <%}%>
    </div>
</div>

<script> 
    const mapToken="<%-process.env.MapToken%>"; 
    const campData= "<%-JSON.stringify(camp.geometry.coordinates)%>";
    const campTitle="<%-camp.title%>";
    const campLocation= "<%-camp.location%>";
</script>

<script src="/showpagemap.js"></script>